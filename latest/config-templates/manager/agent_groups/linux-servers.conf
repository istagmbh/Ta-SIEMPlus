<!--
  agent_groups/linux-servers.conf – Shared Config für Linux-Server-Gruppe
  Template Version: 1.0
  Wazuh Version:    {{ WAZUH_VERSION }}
  Gruppe:           linux-servers
  Kunde:            {{ CUSTOMER_ID }}

  Diese Datei wird auf alle Agenten der Gruppe "linux-servers" verteilt.
  Deployment: /var/ossec/etc/shared/linux-servers/agent.conf
-->
<agent_config>

  <!-- ============================================================
       FIM – Zusätzliche Pfade für Linux-Server
       ============================================================ -->
  <syscheck>
    <!-- Webserver-Konfigurationen -->
    <directories check_all="yes" realtime="yes">/etc/nginx,/etc/apache2</directories>
    <!-- Datenbank-Konfigurationen -->
    <directories check_all="yes">/etc/mysql,/etc/postgresql</directories>
    <!-- SSH-Config -->
    <directories check_all="yes" realtime="yes">/etc/ssh</directories>
    <!-- Cron-Jobs -->
    <directories check_all="yes">/etc/cron.d,/var/spool/cron</directories>

    <!-- Ausschluss: volatile Logs -->
    <ignore>/var/log</ignore>
    <ignore>/var/ossec/logs</ignore>
  </syscheck>

  <!-- ============================================================
       LOG-ANALYSE – Server-spezifische Logs
       ============================================================ -->
  <!-- Nginx (auskommentieren wenn nicht vorhanden) -->
  <!--
  <localfile>
    <log_format>apache</log_format>
    <location>/var/log/nginx/error.log</location>
  </localfile>
  <localfile>
    <log_format>apache</log_format>
    <location>/var/log/nginx/access.log</location>
  </localfile>
  -->

  <!-- Apache (auskommentieren wenn nicht vorhanden) -->
  <!--
  <localfile>
    <log_format>apache</log_format>
    <location>/var/log/apache2/error.log</location>
  </localfile>
  -->

  <!-- MySQL / MariaDB -->
  <!--
  <localfile>
    <log_format>mysql_log</log_format>
    <location>/var/log/mysql/error.log</location>
  </localfile>
  -->

  <!-- Systemd-Journal (alle kritischen Units) -->
  <localfile>
    <log_format>journald</log_format>
    <location>journald</location>
  </localfile>

  <!-- ============================================================
       SCA – Linux-Server-Policy
       ============================================================ -->
  <sca>
    <enabled>yes</enabled>
    <scan_on_start>yes</scan_on_start>
    <interval>12h</interval>
    <skip_nfs>yes</skip_nfs>
    <policies>
      <policy>etc/shared/sca/cis_ubuntu22-04_server.yml</policy>
    </policies>
  </sca>

</agent_config>
