<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wazuh Upgrade Formular - Ta-SIEMPlus</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/ta-alpha-brand.css">
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link" title="Zur√ºck">&#8592;</a>
            <div class="header-inner" style="padding-left: 48px;">
                <img src="assets/ta-alpha-logo.svg" alt="T-Alpha GmbH" class="header-logo">
                <div class="header-text">
                    <h1>Wazuh Upgrade Assistent</h1>
                    <p class="subtitle">T-Alpha GmbH &middot; IT Security</p>
                </div>
            </div>
        </header>

        <div class="content">
            <div class="progress-bar">
                <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
            </div>

            <div class="step-indicator">
                <div class="step active" data-step="1">1. Metadaten</div>
                <div class="step" data-step="2">2. Pre-Flight</div>
                <div class="step" data-step="3">3. Snapshot</div>
                <div class="step" data-step="4">4. Upgrade</div>
                <div class="step" data-step="5">5. Abschluss</div>
            </div>

            <!-- Section 1: Metadata -->
            <div class="section" id="section-metadata">
                <h2>üìù Metadaten & Planung</h2>
                
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Wichtig:</strong> Alle Felder sind erforderlich und werden im PDF-Export dokumentiert.
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>
                            Operator
                            <span class="tooltip" title="Ihr vollst√§ndiger Name">?</span>
                        </label>
                        <input type="text" id="operator" placeholder="Max Mustermann" required>
                    </div>
                    <div class="form-group">
                        <label>
                            Kunde
                            <span class="tooltip" title="Kundenname aus Katalog">?</span>
                        </label>
                        <input type="text" id="customer" placeholder="Beispiel AG" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>
                            Infrastruktur
                            <span class="tooltip" title="Hostname oder Infrastruktur-ID">?</span>
                        </label>
                        <input type="text" id="infrastructure" placeholder="wazuh-prod-01" required>
                    </div>
                    <div class="form-group">
                        <label>
                            Change Ticket ID
                            <span class="tooltip" title="ITIL Change-Management Ticket">?</span>
                        </label>
                        <input type="text" id="changeTicket" placeholder="CHG0012345" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Aktuelle Version</label>
                        <input type="text" id="currentVersion" placeholder="4.7.0" required>
                    </div>
                    <div class="form-group">
                        <label>Zielversion</label>
                        <input type="text" id="targetVersion" placeholder="4.7.3" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Wartungsfenster Start</label>
                        <input type="datetime-local" id="maintenanceStart" required>
                    </div>
                    <div class="form-group">
                        <label>Wartungsfenster Ende</label>
                        <input type="datetime-local" id="maintenanceEnd" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Snapshot/Backup ID</label>
                    <input type="text" id="snapshotId" placeholder="snapshot-2024-01-15-pre-upgrade" required>
                </div>

                <div class="button-group">
                    <button class="btn-primary" onclick="saveMetadata()">Metadaten speichern & weiter ‚Üí</button>
                </div>
            </div>

            <!-- Section 2: Pre-Flight Checks -->
            <div class="section" id="section-preflight" style="display:none;">
                <h2>üîç Pre-Flight Checks</h2>
                
                <div class="alert alert-danger">
                    <strong>üõë No-Go Gates:</strong> ALLE Checks m√ºssen gr√ºn sein, bevor fortgefahren werden darf!
                </div>

                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="check-disk">
                        <span>Disk Usage &lt; 90% auf allen Partitionen (/, /var, /tmp)</span>
                    </label>
                </div>

                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="check-services">
                        <span>Alle Wazuh Services sind 'active (running)' (indexer, manager, dashboard, filebeat)</span>
                    </label>
                </div>

                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="check-cluster">
                        <span>Cluster Health Status = GREEN (keine RED oder YELLOW shards)</span>
                    </label>
                </div>

                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="check-snapshot">
                        <span>Snapshot/Backup existiert und wurde verifiziert</span>
                    </label>
                </div>

                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="check-ticket">
                        <span>Change Ticket ist genehmigt (Status: Approved/Scheduled)</span>
                    </label>
                </div>

                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="check-window">
                        <span>Maintenance Window ist aktiv (aktuelles Datum/Zeit liegt im Fenster)</span>
                    </label>
                </div>

                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="check-version">
                        <span>Upgrade-Pfad ist g√ºltig (Manager Version ‚â• Agent Version nach Upgrade)</span>
                    </label>
                </div>

                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="check-repos">
                        <span>APT Repositories sind erreichbar (packages.wazuh.com)</span>
                    </label>
                </div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="showSection('section-metadata')">‚Üê Zur√ºck</button>
                    <button class="btn-primary" onclick="validatePreFlight()">Pre-Flight abschlie√üen ‚Üí</button>
                </div>
            </div>

            <!-- Section 3: Health Snapshot -->
            <div class="section" id="section-snapshot" style="display:none;">
                <h2>üì∏ Gesundheits-Snapshot (PRE)</h2>
                
                <div class="alert alert-warning">
                    <strong>üìã Aktion erforderlich:</strong> F√ºhren Sie die folgenden Befehle aus und dokumentieren Sie die Ausgabe.
                </div>

                <div class="form-group">
                    <label>Service Status</label>
                    <div class="command-output">systemctl status wazuh-indexer wazuh-manager wazuh-dashboard filebeat --no-pager</div>
                    <textarea id="snapshot-services" rows="4" placeholder="F√ºgen Sie die Ausgabe hier ein..."></textarea>
                </div>

                <div class="form-group">
                    <label>Installierte Versionen</label>
                    <div class="command-output">dpkg -l | grep -E 'wazuh-(indexer|manager|dashboard)|filebeat'</div>
                    <textarea id="snapshot-versions" rows="4" placeholder="F√ºgen Sie die Ausgabe hier ein..."></textarea>
                </div>

                <div class="form-group">
                    <label>Cluster Health</label>
                    <div class="command-output">curl -sk -u admin:admin https://127.0.0.1:9200/_cluster/health?pretty</div>
                    <textarea id="snapshot-cluster" rows="4" placeholder="F√ºgen Sie die Ausgabe hier ein..."></textarea>
                </div>

                <div class="form-group">
                    <label>Disk Usage</label>
                    <div class="command-output">df -h</div>
                    <textarea id="snapshot-disk" rows="4" placeholder="F√ºgen Sie die Ausgabe hier ein..."></textarea>
                </div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="showSection('section-preflight')">‚Üê Zur√ºck</button>
                    <button class="btn-primary" onclick="saveSnapshot()">Snapshot speichern & weiter ‚Üí</button>
                </div>
            </div>

            <!-- Section 4: Upgrade Steps -->
            <div class="section" id="section-upgrade" style="display:none;">
                <h2>‚öôÔ∏è Upgrade Durchf√ºhrung</h2>
                
                <div class="alert alert-success">
                    <strong>‚úì Bereit:</strong> Folgen Sie den Schritten in der angegebenen Reihenfolge.
                </div>

                <h3 style="margin-top: 20px; color: #667eea;">Schritt 1: Indexer Upgrade</h3>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="step-indexer-stop">
                        <span>Indexer stoppen: <code>systemctl stop wazuh-indexer</code></span>
                    </label>
                </div>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="step-indexer-upgrade">
                        <span>Upgrade durchf√ºhren: <code>apt-get update && apt-get install wazuh-indexer</code></span>
                    </label>
                </div>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="step-indexer-start">
                        <span>Indexer starten: <code>systemctl start wazuh-indexer</code></span>
                    </label>
                </div>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="step-indexer-verify">
                        <span>Status verifizieren: Cluster Health = GREEN</span>
                    </label>
                </div>

                <h3 style="margin-top: 30px; color: #667eea;">Schritt 2: Manager Upgrade</h3>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="step-manager-upgrade">
                        <span>Manager upgraden: <code>apt-get install wazuh-manager</code></span>
                    </label>
                </div>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="step-manager-verify">
                        <span>Status verifizieren: <code>systemctl status wazuh-manager</code></span>
                    </label>
                </div>

                <h3 style="margin-top: 30px; color: #667eea;">Schritt 3: Filebeat Upgrade</h3>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="step-filebeat-upgrade">
                        <span>Filebeat upgraden: <code>apt-get install filebeat</code></span>
                    </label>
                </div>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="step-filebeat-verify">
                        <span>Status verifizieren: <code>systemctl status filebeat</code></span>
                    </label>
                </div>

                <h3 style="margin-top: 30px; color: #667eea;">Schritt 4: Dashboard Upgrade</h3>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="step-dashboard-upgrade">
                        <span>Dashboard upgraden: <code>apt-get install wazuh-dashboard</code></span>
                    </label>
                </div>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="step-dashboard-verify">
                        <span>Status verifizieren: <code>systemctl status wazuh-dashboard</code></span>
                    </label>
                </div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="showSection('section-snapshot')">‚Üê Zur√ºck</button>
                    <button class="btn-primary" onclick="completeUpgrade()">Upgrade abschlie√üen ‚Üí</button>
                </div>
            </div>

            <!-- Section 5: Completion -->
            <div class="section" id="section-completion" style="display:none;">
                <h2>‚úÖ Abschluss & Dokumentation</h2>
                
                <div class="alert alert-success">
                    <strong>üéâ Fast geschafft!</strong> Erfassen Sie die Post-Upgrade Daten f√ºr die Dokumentation.
                </div>

                <h3 style="color: #667eea; margin-bottom: 15px;">Post-Upgrade Snapshot</h3>

                <div class="form-group">
                    <label>Service Status (POST)</label>
                    <textarea id="post-snapshot-services" rows="4" placeholder="systemctl status output..."></textarea>
                </div>

                <div class="form-group">
                    <label>Installierte Versionen (POST)</label>
                    <textarea id="post-snapshot-versions" rows="4" placeholder="dpkg -l output..."></textarea>
                </div>

                <div class="form-group">
                    <label>Cluster Health (POST)</label>
                    <textarea id="post-snapshot-cluster" rows="4" placeholder="Cluster health output..."></textarea>
                </div>

                <h3 style="color: #667eea; margin: 30px 0 15px;">Upgrade-Zusammenfassung</h3>

                <div class="form-group">
                    <label>Aufgetretene Probleme (falls zutreffend)</label>
                    <textarea id="problems" rows="3" placeholder="Beschreiben Sie aufgetretene Probleme oder 'Keine'"></textarea>
                </div>

                <div class="form-group">
                    <label>L√∂sungsma√ünahmen (falls zutreffend)</label>
                    <textarea id="resolutions" rows="3" placeholder="Beschreiben Sie durchgef√ºhrte L√∂sungen oder 'N/A'"></textarea>
                </div>

                <div class="form-group">
                    <label>Upgrade-Dauer (Minuten)</label>
                    <input type="number" id="duration" placeholder="45" min="1">
                </div>

                <div class="form-group">
                    <label>Zus√§tzliche Bemerkungen</label>
                    <textarea id="notes" rows="4" placeholder="Weitere wichtige Informationen..."></textarea>
                </div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="showSection('section-upgrade')">‚Üê Zur√ºck</button>
                    <button class="btn-success" onclick="generatePDF()">üìÑ PDF-Report generieren</button>
                    <button class="btn-secondary" onclick="clearForm()">üîÑ Formular zur√ºcksetzen</button>
                </div>
            </div>
        </div>

        <footer>
            <p>
                <strong>Ta-SIEMPlus</strong> - Wazuh SIEM Management<br>
                Referenz: <a href="../runbooks/RUNBOOK_WAZUH_UPGRADE_AIO_UBUNTU/" style="color: #667eea;">Upgrade Runbook</a>
            </p>
        </footer>
    </div>

    <script>
        // LocalStorage keys
        const STORAGE_KEY = 'wazuh_upgrade_form';

        // Load saved data on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadFormData();
            updateProgress();
        });

        // Auto-save on input changes
        document.addEventListener('input', () => {
            saveFormData();
        });

        function saveFormData() {
            const formData = {
                operator: document.getElementById('operator').value,
                customer: document.getElementById('customer').value,
                infrastructure: document.getElementById('infrastructure').value,
                changeTicket: document.getElementById('changeTicket').value,
                currentVersion: document.getElementById('currentVersion').value,
                targetVersion: document.getElementById('targetVersion').value,
                maintenanceStart: document.getElementById('maintenanceStart').value,
                maintenanceEnd: document.getElementById('maintenanceEnd').value,
                snapshotId: document.getElementById('snapshotId').value,
                checks: {
                    disk: document.getElementById('check-disk')?.checked,
                    services: document.getElementById('check-services')?.checked,
                    cluster: document.getElementById('check-cluster')?.checked,
                    snapshot: document.getElementById('check-snapshot')?.checked,
                    ticket: document.getElementById('check-ticket')?.checked,
                    window: document.getElementById('check-window')?.checked,
                    version: document.getElementById('check-version')?.checked,
                    repos: document.getElementById('check-repos')?.checked
                },
                snapshots: {
                    services: document.getElementById('snapshot-services')?.value,
                    versions: document.getElementById('snapshot-versions')?.value,
                    cluster: document.getElementById('snapshot-cluster')?.value,
                    disk: document.getElementById('snapshot-disk')?.value
                },
                postSnapshots: {
                    services: document.getElementById('post-snapshot-services')?.value,
                    versions: document.getElementById('post-snapshot-versions')?.value,
                    cluster: document.getElementById('post-snapshot-cluster')?.value
                },
                completion: {
                    problems: document.getElementById('problems')?.value,
                    resolutions: document.getElementById('resolutions')?.value,
                    duration: document.getElementById('duration')?.value,
                    notes: document.getElementById('notes')?.value
                }
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(formData));
        }

        function loadFormData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (!saved) return;

            const formData = JSON.parse(saved);
            
            document.getElementById('operator').value = formData.operator || '';
            document.getElementById('customer').value = formData.customer || '';
            document.getElementById('infrastructure').value = formData.infrastructure || '';
            document.getElementById('changeTicket').value = formData.changeTicket || '';
            document.getElementById('currentVersion').value = formData.currentVersion || '';
            document.getElementById('targetVersion').value = formData.targetVersion || '';
            document.getElementById('maintenanceStart').value = formData.maintenanceStart || '';
            document.getElementById('maintenanceEnd').value = formData.maintenanceEnd || '';
            document.getElementById('snapshotId').value = formData.snapshotId || '';

            if (formData.checks) {
                Object.keys(formData.checks).forEach(key => {
                    const checkbox = document.getElementById(`check-${key}`);
                    if (checkbox) checkbox.checked = formData.checks[key];
                });
            }

            if (formData.snapshots) {
                Object.keys(formData.snapshots).forEach(key => {
                    const field = document.getElementById(`snapshot-${key}`);
                    if (field) field.value = formData.snapshots[key] || '';
                });
            }

            if (formData.postSnapshots) {
                Object.keys(formData.postSnapshots).forEach(key => {
                    const field = document.getElementById(`post-snapshot-${key}`);
                    if (field) field.value = formData.postSnapshots[key] || '';
                });
            }

            if (formData.completion) {
                Object.keys(formData.completion).forEach(key => {
                    const field = document.getElementById(key);
                    if (field) field.value = formData.completion[key] || '';
                });
            }
        }

        function saveMetadata() {
            const required = ['operator', 'customer', 'infrastructure', 'changeTicket', 
                            'currentVersion', 'targetVersion', 'maintenanceStart', 
                            'maintenanceEnd', 'snapshotId'];
            
            for (const field of required) {
                if (!document.getElementById(field).value) {
                    alert(`Bitte f√ºllen Sie das Feld "${field}" aus.`);
                    return;
                }
            }
            
            showSection('section-preflight');
        }

        function validatePreFlight() {
            const checks = ['disk', 'services', 'cluster', 'snapshot', 'ticket', 'window', 'version', 'repos'];
            const allChecked = checks.every(check => document.getElementById(`check-${check}`).checked);
            
            if (!allChecked) {
                alert('‚ö†Ô∏è STOP: Alle Pre-Flight Checks m√ºssen erf√ºllt sein!');
                return;
            }
            
            showSection('section-snapshot');
        }

        function saveSnapshot() {
            const snapshots = ['services', 'versions', 'cluster', 'disk'];
            const allFilled = snapshots.every(snap => document.getElementById(`snapshot-${snap}`).value);
            
            if (!allFilled) {
                if (!confirm('Nicht alle Snapshots sind ausgef√ºllt. Trotzdem fortfahren?')) {
                    return;
                }
            }
            
            showSection('section-upgrade');
        }

        function completeUpgrade() {
            if (!confirm('Sind alle Upgrade-Schritte abgeschlossen und verifiziert?')) {
                return;
            }
            showSection('section-completion');
        }

        function showSection(sectionId) {
            const sections = ['section-metadata', 'section-preflight', 'section-snapshot', 
                            'section-upgrade', 'section-completion'];
            sections.forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';
            
            const stepMap = {
                'section-metadata': 1,
                'section-preflight': 2,
                'section-snapshot': 3,
                'section-upgrade': 4,
                'section-completion': 5
            };
            
            updateStepIndicator(stepMap[sectionId]);
            updateProgress();
        }

        function updateStepIndicator(activeStep) {
            document.querySelectorAll('.step').forEach(step => {
                const stepNum = parseInt(step.dataset.step);
                step.classList.remove('active', 'completed');
                
                if (stepNum === activeStep) {
                    step.classList.add('active');
                } else if (stepNum < activeStep) {
                    step.classList.add('completed');
                }
            });
        }

        function updateProgress() {
            const sections = ['section-metadata', 'section-preflight', 'section-snapshot', 
                            'section-upgrade', 'section-completion'];
            const visibleSection = sections.findIndex(id => 
                document.getElementById(id).style.display !== 'none'
            );
            const progress = ((visibleSection + 1) / sections.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const leftMargin = 15;
            let yPos = 20;
            const lineHeight = 7;
            
            // Title
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('Wazuh Upgrade Report', leftMargin, yPos);
            yPos += 15;
            
            // Metadata
            doc.setFontSize(14);
            doc.text('Metadaten', leftMargin, yPos);
            yPos += 10;
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            const metadata = [
                ['Operator:', document.getElementById('operator').value],
                ['Kunde:', document.getElementById('customer').value],
                ['Infrastruktur:', document.getElementById('infrastructure').value],
                ['Change Ticket:', document.getElementById('changeTicket').value],
                ['Von Version:', document.getElementById('currentVersion').value],
                ['Zu Version:', document.getElementById('targetVersion').value],
                ['Wartungsfenster:', `${document.getElementById('maintenanceStart').value} - ${document.getElementById('maintenanceEnd').value}`],
                ['Snapshot ID:', document.getElementById('snapshotId').value],
                ['Datum:', new Date().toLocaleString('de-DE')]
            ];
            
            metadata.forEach(([label, value]) => {
                doc.text(`${label} ${value}`, leftMargin, yPos);
                yPos += lineHeight;
            });
            
            yPos += 10;
            
            // Pre-Flight Checks
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('Pre-Flight Checks', leftMargin, yPos);
            yPos += 10;
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            const checks = [
                ['Disk Usage', 'check-disk'],
                ['Services', 'check-services'],
                ['Cluster Health', 'check-cluster'],
                ['Snapshot', 'check-snapshot'],
                ['Change Ticket', 'check-ticket'],
                ['Maintenance Window', 'check-window'],
                ['Version Path', 'check-version'],
                ['Repositories', 'check-repos']
            ];
            
            checks.forEach(([label, id]) => {
                const status = document.getElementById(id).checked ? '[OK]' : '[FAIL]';
                doc.text(`${status} ${label}`, leftMargin, yPos);
                yPos += lineHeight;
            });
            
            // Add new page for snapshots
            doc.addPage();
            yPos = 20;
            
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('Health Snapshots', leftMargin, yPos);
            yPos += 10;
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text('PRE-Upgrade Snapshot und POST-Upgrade Snapshot', leftMargin, yPos);
            yPos += 7;
            doc.text('(Siehe angeh√§ngte Logs f√ºr Details)', leftMargin, yPos);
            
            yPos += 15;
            
            // Completion data
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('Zusammenfassung', leftMargin, yPos);
            yPos += 10;
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            
            const duration = document.getElementById('duration').value;
            if (duration) {
                doc.text(`Dauer: ${duration} Minuten`, leftMargin, yPos);
                yPos += lineHeight;
            }
            
            const problems = document.getElementById('problems').value;
            if (problems) {
                doc.text('Probleme:', leftMargin, yPos);
                yPos += lineHeight;
                const problemLines = doc.splitTextToSize(problems, 180);
                doc.text(problemLines, leftMargin + 5, yPos);
                yPos += problemLines.length * lineHeight + 5;
            }
            
            const resolutions = document.getElementById('resolutions').value;
            if (resolutions) {
                doc.text('L√∂sungen:', leftMargin, yPos);
                yPos += lineHeight;
                const resolutionLines = doc.splitTextToSize(resolutions, 180);
                doc.text(resolutionLines, leftMargin + 5, yPos);
                yPos += resolutionLines.length * lineHeight + 5;
            }
            
            const notes = document.getElementById('notes').value;
            if (notes) {
                doc.text('Bemerkungen:', leftMargin, yPos);
                yPos += lineHeight;
                const noteLines = doc.splitTextToSize(notes, 180);
                doc.text(noteLines, leftMargin + 5, yPos);
            }
            
            // Footer
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.text(`Seite ${i} von ${pageCount}`, 
                    doc.internal.pageSize.width / 2, 
                    doc.internal.pageSize.height - 10, 
                    { align: 'center' });
            }
            
            const filename = `Wazuh_Upgrade_${document.getElementById('customer').value.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(filename);
            
            alert('‚úÖ PDF-Report wurde erfolgreich generiert!');
        }

        function clearForm() {
            if (!confirm('M√∂chten Sie wirklich alle Formulardaten l√∂schen?')) {
                return;
            }
            localStorage.removeItem(STORAGE_KEY);
            location.reload();
        }
    </script>
    
    <footer class="ta-footer">
        <p>&copy; 2026 <a href="https://www.t-alpha.ch" target="_blank">T-Alpha GmbH</a> &middot; IT Security &middot; <a href="https://req.t-alpha.ch/" target="_blank">req.t-alpha.ch</a></p>
    </footer>
</body>
</html>
